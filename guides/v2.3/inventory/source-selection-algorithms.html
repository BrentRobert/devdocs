<!DOCTYPE html>
<html lang="" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Source selection algorithms | Magento 2 Developer Documentation (copy)</title>
	<meta name="description" content="Copy of the Magento 2 Developer Documentation.">

	<link rel="stylesheet" href="/devdocs/assets/css/app.css" />
	<link rel="stylesheet" href="/devdocs/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/devdocs/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />

	<script>
  var baseUrl = "/devdocs";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main"></button>
  </div>

  <div class="nav-container">

    <a class="logo" href="/devdocs/">
      <img src="/devdocs/assets/i/m-logo.svg" alt=""><img src="/devdocs/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs (archived, unofficial)</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.3">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.3
    </button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
		
		<li><a class="dropdown-item" data-proofer-ignore href="/devdocs/guides/v2.0/inventory/source-selection-algorithms.html">Magento 2.0</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/devdocs/guides/v2.1/inventory/source-selection-algorithms.html">Magento 2.1</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/devdocs/guides/v2.2/inventory/source-selection-algorithms.html">Magento 2.2</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/devdocs/guides/v2.3/inventory/source-selection-algorithms.html">Magento 2.3</a></li>
		
  </ul>
</div>


      <!-- Main Navigation -->


<ul class="nav-main" role="menubar">




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span>

    
      <div class="nav-popup">

      

      
        <ul>
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/bk-cloud.html">Cloud Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/architecture/cloud-architecture.html">Cloud Architecture</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/setup/first-time-setup.html">Local Development</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/docker/docker-quick-reference.html">Docker quick reference</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/env/environments.html">Configure Environments</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/release-notes/cloud-tools.html">Release Notes</a>
  
  
</li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span>

    
      <div class="nav-popup">

      

      
        <ul>
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/install-gde/bk-install-guide.html">Installation Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/comp-mgr/bk-compman-upgrade-guide.html">Extension Update and System Upgrade Guide</a>
  
  
</li>



          
        
          
          
            







          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/config-guide/bk-config-guide.html">Configuration Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/performance-best-practices/introduction.html">Performance Best Practices</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/migration/bk-migration-guide.html">Migration Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/release-notes/bk-release-notes.html">Release Information</a>
  
  
</li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span>

    
      <div class="nav-popup">

      

      
        
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul>
              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/architecture/bk-architecture.html">Architecture</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/mrg/intro.html">Module Reference Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/coding-standards/bk-coding-standards.html">Coding Standards</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/contributor-guide/contributing.html">Contributor Guide</a>
  
  
</li>



              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul>
              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a>
  
  
</li>



              
                







              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/pattern-library/bk-pattern.html">Admin Design Pattern Library</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/design-styleguide/bk-styleguide.html">Admin Style Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://magento-research.github.io/pwa-studio/">Magento PWA Documentation Site</a>
  
  
</li>



              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul>
              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/rest/bk-rest.html">REST API Reference</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/soap/bk-soap.html">SOAP API Reference</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/graphql/">GraphQL Developer Guide</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/marketplace/eqp/api.html">Marketplace EQP API Reference</a>
  
  
</li>



              
                





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://developers.rjmetrics.com/">Magento BI Import REST API</a>
  
  
</li>



              
              </ul>
            </div>
          
        
      
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span>

    
      <div class="nav-popup">

      

      
        <ul>
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/test/testing.html">Magento Testing Guide</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/mftf/2.3/introduction.html">Functional Acceptance Testing (MFTF)</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/mtf/mtf_introduction.html">Functional Testing</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/test/integration/integration_test_execution.html">Integration Testing</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/test/js/jasmine.html">JavaScript Unit Testing</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/test/unit/unit_test_execution.html">PHP Unit Testing</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/get-started/web-api-functional-testing.html">Web API Functional Testing</a>
  
  
</li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-separator"></li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span>

    
      <div class="nav-popup">

      

      
        <ul>
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/advanced-reporting/overview.html">Advanced Reporting</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/b2b/bk-b2b.html">B2B</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/howdoi/checkout/checkout_overview.html">Checkout</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/index.html">Inventory Management</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="http://omsdocs.magento.com/en/">Order Management</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/payments-integrations/bk-payments-integrations.html">Payment Integrations</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/extension-dev-guide/staging.html">Staging</a>
  
  
</li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span>

    
      <div class="nav-popup">

      

      
        <ul>
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/rest/tutorials/index.html">Rest Tutorials</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/howdoi/customize_product.html">Customize Product Creation Form</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/howdoi/checkout/checkout_overview.html">Customize Checkout</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/community/resources/support.html">Magento Support</a>
  
  
</li>



          
        
          
          
            





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/videos/">Video Tutorials</a>
  
  
</li>



          
        
      </ul>
      

      </div>
    

  </li>
  



</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <button class="search-trigger search-icon" aria-label="Search"></button>
    </div>

    <form class="quick-search" action="/devdocs/guides/v2.3/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <button class="quick-search-close" aria-label="Close Search">&times;</button>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		


		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Inventory Management Guide</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/index.html">Overview</a>
  
  
</li>



		    
		    	





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/architecture.html">Inventory management architecture</a>
  
  
</li>



		    
		    	





  
  
  

  
  
<li class="active " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/source-selection-algorithms.html">Source selection algorithms</a>
  
  
</li>



		    
		    	





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/catalog-inventory-replacements.html">Deprecated CatalogInventory entities</a>
  
  
</li>



		    
		    	





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/inventory/scalable-inventory-replacements.html">Deprecated ScalableInventory entities</a>
  
  
</li>



		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

	

	<h1 class="page-heading">Source selection algorithms</h1>
</section>

			<p>The <strong>Source Selection Algorithm (SSA)</strong> recommends how to fulfill partial and full shipments. The merchant decides which business needs take precedence when deciding which shipping method to use:</p>

<ul>
  <li>Should the products be delivered from the sources designated as having the highest priority?</li>
  <li>Should the total shipment cost be the primary factor in choosing a shipment method?</li>
  <li>Should the shipments originate from the closest source?</li>
  <li>Should the fastest shipping method with the shortest delivery time be used, even if it’s not the cheapest?</li>
</ul>

<p>Magento 2.3 provides the priority-based SSA only. Third party developers can create their own algorithms to 
help merchants decide which shipping option best meets their needs.</p>

<p>Magento does not enforce or save the results of SSA recommendations. The recommendations reflect conditions at the moment when the algorithm runs, but conditions change over time. For example, the amount of in-stock products will always fluctuate, and shipping costs might change. The merchant can also modify the recommendations by adjusting quantities for deduction or even by re-assigning the shipment’s sources of origin.</p>

<h2 id="the-priority-algorithm">The priority algorithm</h2>

<p>Inventory Management defines the priority algorithm, which recommends delivering products from sources having the highest priority. The <code class="highlighter-rouge">SourceSelectionServiceInterface</code> accepts an <code class="highlighter-rouge">InventoryRequestInterface</code> object, which in turn contains the stock ID and a list of items to be shipped. Each item contains only the SKU and quantity. Other potentially relevant data, such as shipping address, is not included, because the priority algorithm does not need it.</p>

<p>Additional input data might be needed for more sophisticated algorithms. For example, an algorithm that calculates distance would need the shipping address and all data entered for the source (GPS or full address). That’s why <code class="highlighter-rouge">InventoryRequestInterface</code> implements <code class="highlighter-rouge">ExtensibleDataInterface</code> interfaces, which can be extended with custom input parameters.</p>

<h2 id="ssa-interfaces">SSA interfaces</h2>

<p>Currently, Inventory Management deducts stock from the appropriate source after the merchant creates a shipment for an order. However, that’s not flexible enough–a developer might want to introduce customizations and launch the SSA when the customer proceeds to checkout. Running the SSA at this point could provide the customer more accurate shipping costs. Note in this case, the <code class="highlighter-rouge">Order</code> object has not created yet, and the system must instead rely on the <code class="highlighter-rouge">Quote</code> object.</p>

<p>Taking into account that there are at least two valid business cases when to launch the SSA, and the data source can be an <code class="highlighter-rouge">Order</code> or <code class="highlighter-rouge">Quote</code> object, Inventory Management introduces a new layer of abstraction. The algorithm must use an abstract data container instead of a specific Magento entity.</p>

<p>Use these interfaces to create your own SSA:</p>

<ul>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Api/Data/InventoryRequestInterface.php">InventoryRequestInterface</a> requests products for a given quantity and stock ID</li>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Api/Data/ItemRequestInterface.php">ItemRequestInterface</a> represents the requested quantity for a specific SKU</li>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Api/SourceSelectionServiceInterface.php">SourceSelectionServiceInterface</a> returns the source selection algorithm result for the specified <code class="highlighter-rouge">inventoryRequest</code></li>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Api/GetSourceSelectionAlgorithmListInterface.php">GetSourceSelectionAlgorithmListInterface</a> returns the list of data interfaces that represent registered SSAs</li>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Api/Data/SourceSelectionAlgorithmInterface.php">SourceSelectionAlgorithmInterface</a> represents a single SSA</li>
  <li><a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventorySourceSelectionApi/Model/SourceSelectionInterface.php">SourceSelectionInterface</a> returns the SSA result for the specified <code class="highlighter-rouge">inventoryRequest</code></li>
</ul>

<h2 id="develop-a-custom-algorithm">Develop a custom algorithm</h2>

<p>As you develop your custom Source Selection Algorithm, keep these design considerations in mind:</p>

<ul>
  <li>Implement <code class="highlighter-rouge">SourceSelectionInterface</code></li>
  <li>If your module provides an SSA on quotes, introduce your own <code class="highlighter-rouge">InventoryRequestFactory</code></li>
  <li>Register your SSA within a <code class="highlighter-rouge">di.xml</code> file</li>
</ul>

<h3 id="implement--sourceselectioninterface">Implement  <code class="highlighter-rouge">SourceSelectionInterface</code></h3>

<p>Your SSA must implement <code class="highlighter-rouge">SourceSelectionInterface</code>, which is shown below:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><span class="sd">/**
 * Returns source selection algorithm result for given Inventory Request 
 * Current interface should be implemented in order to add own Source Selection Method
 * 
 * @api
 */</span>
<span class="k">interface</span> <span class="nx">SourceSelectionInterface</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param InventoryRequestInterface $inventoryRequest
     * @return SourceSelectionResultInterface
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span>
       <span class="nx">InventoryRequestInterface</span> <span class="nv">$inventoryRequest</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">SourceSelectionResultInterface</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For example, the following example defines the <code class="highlighter-rouge">MinimalDeliveryCostAlgorithm</code> class:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><span class="k">namespace</span> <span class="nx">Some\Vendor\Namespace\SourceSelection</span><span class="p">;</span>

<span class="sd">/**
 * Minimal Delivery Cost for Merchant algorithm
 *
 * @api
 */</span>
<span class="k">class</span> <span class="nc">MinimalDeliveryCostAlgorithm</span> <span class="k">implements</span> <span class="nx">SourceSelectionInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span>
       <span class="nx">InventoryRequestInterface</span> <span class="nv">$inventoryRequest</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">SourceSelectionResultInterface</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="c1">// TODO: Implement execute() method.
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-a-inventoryrequest-factory-for-quotes--optional">Create a <code class="highlighter-rouge">InventoryRequest</code> factory for quotes  (optional)</h3>

<p>Magento provides the <a href="https://github.com/magento-engcom/msi/blob/2.3.0-release/app/code/Magento/InventoryShipping/Model/InventoryRequestFromOrderFactory.php"><code class="highlighter-rouge">InventoryRequestFromOrderFactory</code></a>, which determines the sources to use to fulfill the order at the time a shipment is created.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><span class="k">class</span> <span class="nc">InventoryRequestFromOrderFactory</span>
<span class="p">{</span>
      <span class="sd">/**
     * @param OrderInterface $order
     * @return InventoryRequestInterface
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">OrderInterface</span> <span class="nv">$order</span><span class="p">)</span> <span class="o">:</span> <span class="nx">InventoryRequestInterface</span>
    <span class="p">{</span>
        <span class="nv">$requestItems</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$websiteId</span> <span class="o">=</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">getStore</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getWebsiteId</span><span class="p">();</span>
        <span class="nv">$stockId</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stockByWebsiteIdResolver</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">((</span><span class="nx">int</span><span class="p">)</span><span class="nv">$websiteId</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStockId</span><span class="p">();</span>
        <span class="sd">/** @var OrderItemInterface|OrderItem $orderItem */</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">getItems</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$orderItem</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$itemSku</span> <span class="o">=</span> <span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getSku</span><span class="p">()</span> <span class="o">?:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSkusByProductIds</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span>
                <span class="p">[</span><span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getProductId</span><span class="p">()]</span>
            <span class="p">)[</span><span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getProductId</span><span class="p">()];</span>
            <span class="nv">$qtyToDeliver</span> <span class="o">=</span> <span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getQtyToShip</span><span class="p">();</span>
            <span class="c1">//check if order item is not delivered yet
</span>            <span class="k">if</span> <span class="p">(</span><span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">isDeleted</span><span class="p">()</span>
                <span class="o">||</span> <span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getParentItemId</span><span class="p">()</span>
                <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isZero</span><span class="p">((</span><span class="nx">float</span><span class="p">)</span><span class="nv">$qtyToDeliver</span><span class="p">)</span>
                <span class="o">||</span> <span class="nv">$orderItem</span><span class="o">-&gt;</span><span class="na">getIsVirtual</span><span class="p">()</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$requestItems</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">itemRequestFactory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
                    <span class="s1">'sku'</span> <span class="o">=&gt;</span> <span class="nv">$itemSku</span><span class="p">,</span>
                    <span class="s1">'qty'</span> <span class="o">=&gt;</span> <span class="nv">$qtyToDeliver</span>
            <span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">inventoryRequestFactory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">'stockId'</span> <span class="o">=&gt;</span> <span class="nv">$stockId</span><span class="p">,</span>
            <span class="s1">'items'</span> <span class="o">=&gt;</span> <span class="nv">$requestItems</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To add an SSA at the time of checkout, introduce your own factory that produces an  <code class="highlighter-rouge">InventoryRequestInterface</code> based on a <code class="highlighter-rouge">Quote</code> object, outlined as follows:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><span class="k">class</span> <span class="nc">InventoryRequestFactory</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param \Magento\Quote\Api\Data\CartInterface $quote
     * @return InventoryRequestInterface
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">\Magento\Quote\Api\Data\CartInterface</span> <span class="nv">$quote</span><span class="p">)</span> <span class="o">:</span> <span class="nx">InventoryRequestInterface</span> 
    <span class="p">{</span>
        <span class="c1">// TODO
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="configure-dixml">Configure <code class="highlighter-rouge">di.xml</code></h3>

<p>Configure your module’s <code class="highlighter-rouge">etc/di.xml</code> file to register your SSA with <code class="highlighter-rouge">SourceSelectionServiceInterface</code> and <code class="highlighter-rouge">GetSourceSelectionAlgorithmList</code>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"Magento\InventorySourceSelection\Model\SourceSelectionService"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"sourceSelectionMethods"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"minimalDeliveryCost"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>Some\Vendor\Namespace\SourceSelection\MinimalDeliveryCostAlgorithm<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/type&gt;</span>
<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"Magento\InventorySourceSelectionApi\Model\GetSourceSelectionAlgorithmList"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"availableAlgorithms"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"minimalDeliveryCost"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">xsi:type=</span><span class="s">"string"</span> <span class="na">name=</span><span class="s">"code"</span><span class="nt">&gt;</span>minimalDeliveryCost<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">xsi:type=</span><span class="s">"string"</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">translatable=</span><span class="s">"true"</span><span class="nt">&gt;</span>Minimal Delivery Cost<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">xsi:type=</span><span class="s">"string"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">translatable=</span><span class="s">"true"</span><span class="nt">&gt;</span>Algorithm that calculates the shipping option with the lowest shipping cost to the merchant.<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</code></pre></div></div>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  


  

    

    

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      

<ul class="nav footer-links">

  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://magento.com/legal/terms/privacy/">Privacy Policy</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://magento.com/legal/terms/">Terms of Service</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="https://magento.com/legal/licensing/">License/Trademark FAQ</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/guides/v2.3/release-notes/bk-release-notes.html">Release Notes</a>
  
  
</li>




  





  
  
  

  
  
<li class=" " role="menuitem">
  
  <a href="/devdocs/magento-third-party.html">Third-Party Licenses</a>
  
  
</li>




</ul>

    </div>

		<div class="copyright-date">&copy; 2021 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs/assets/js/app.min.js"></script>






</body>
</html>

